# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃     FLY APP COMPREHENSIVE CONFIG – ALL DOCUMENTED FIELDS    ┃
# ┃         Defaults shown per Fly docs (May 1 2025)            ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
# app            = "APP_NAME"       # unique across Fly ↦ docs
primary_region = "atl"            # three-letter region

# ─── Runtime options ───────────────────────────────────────────
# kill_signal   = "SIGINT"          # default signal
# kill_timeout  = 5                 # seconds (≤ 300)
# console_command = ""              # optional REPL command
# swap_size_mb    = 0               # 0 = disabled

# ─── Build (only ONE of the image/builder/dockerfile paths) ───
# [build]
#   builder      = ""                # Paketo/GCP buildpacks etc.
#   image        = ""                # registry reference
#   dockerfile   = "Dockerfile"      # default name
#   ignorefile   = ".dockerignore"   # default
#   build-target = ""                # multistage target
#   [build.args]                     # build-time ARGs
    # KEY = "value"

# ─── Deploy behaviour ──────────────────────────────────────────
[deploy]
#   release_command          = ""    # run before release
#   release_command_timeout  = "5m"  # default
  strategy                 = "bluegreen"  # "rolling" or "bluegreen"
#   max_unavailable          = 0.33  # for rolling
  wait_timeout             = "1m"
#   [deploy.release_command_vm]      # size for the one-off VM
#     size   = ""
#     memory = ""

# ─── Non-secret environment variables ─────────────────────────
[env]
  # LOG_LEVEL = "info"

# ───────────────────────────────────────────────────────────────
# 1) Short form: ONE public HTTP/HTTPS service on ports 80/443
# ───────────────────────────────────────────────────────────────
[http_service]
  # processes            = []        # limit to groups
  internal_port        = 8080      # default
  force_https          = true
  # auto_stop_machines   = "off"
  # auto_start_machines  = true
  # min_machines_running = 0

  # [http_service.concurrency]
  #   type       = "connections"
  #   soft_limit = 20
  #   hard_limit = 0                # 0 = disabled

  # [http_service.http_options]
  #   idle_timeout = 0              # 0 = Fly default (~60 s)
  #   h2_backend   = false
  #   [http_service.http_options.response]
  #     pristine = false
  #     [http_service.http_options.response.headers]
        # Header-Name = "value"   # or Header-Name = false to strip

  # [http_service.tls_options]
  #   alpn                = ["h2", "http/1.1"]
  #   versions            = ["TLSv1.2", "TLSv1.3"]
  #   default_self_signed = false

  [[http_service.checks]]
    grace_period   = "10s"
    interval       = "10s"
    timeout        = "3s"
    method         = "get"
    path           = "/health"
    protocol       = "http"
    # tls_skip_verify = false
    # [http_service.checks.headers]
      # X-Forwarded-Proto = "https"

  # [[http_service.machine_checks]]
  #   image        = ""
  #   entrypoint   = []
  #   command      = []
  #   kill_signal  = "SIGKILL"
  #   kill_timeout = "5s"

# ───────────────────────────────────────────────────────────────
# 2) Verbose form: multiple services, TCP/UDP, custom ports
# ───────────────────────────────────────────────────────────────
# [[services]]
#   processes            = []
#   internal_port        = 8080
#   protocol             = "tcp"
#   auto_stop_machines   = "off"
#   auto_start_machines  = true
#   min_machines_running = 0

#   [[services.ports]]              # port 80 HTTP
#     handlers    = ["http"]
#     port        = 80
#     force_https = false

#   [[services.ports]]              # port 443 TLS+HTTP
#     handlers    = ["tls", "http"]
#     port        = 443

#     # Per-port proxy tweaks
#     [services.ports.http_options]
#       idle_timeout = 0
#       h2_backend   = false
#       [services.ports.http_options.response]
#         pristine = false
#         [services.ports.http_options.response.headers]
#           # Key = false

#     proxy_proto_options = { version = "v1" }
#     tls_options         = { alpn = ["http/1.1"], versions = ["TLSv1.2"] }

#   [services.concurrency]
#     type       = "connections"
#     soft_limit = 20
#     hard_limit = 0

#   [[services.tcp_checks]]
#     grace_period  = "1s"
#     interval      = "15s"
#     timeout       = "2s"
#     restart_limit = 0

#   [[services.http_checks]]
#     grace_period  = "5s"
#     interval      = "10s"
#     timeout       = "2s"
#     method        = "get"
#     path          = "/"
#     protocol      = "http"
#     tls_skip_verify = false
#     [services.http_checks.headers]

#   [[services.machine_checks]]
#     image        = ""
#     entrypoint   = []
#     command      = []

# ─── Volumes / mounts ──────────────────────────────────────────
# [[mounts]]
#   source      = "VOLUME_NAME"
#   destination = "/data"
#   processes   = []
#   initial_size = ""
#   snapshot_retention = 5
#   auto_extend_size_threshold = 0
#   auto_extend_size_increment = ""
#   auto_extend_size_limit     = ""

# ─── Compute sizing ───────────────────────────────────────────
[[vm]]
  size      = "shared-cpu-2x"
  memory    = "1024mb"
  # cpus      = 1
  # cpu_kind  = "shared"
  # gpus      = 0
  # gpu_kind  = ""
  # kernel_args = ""
  # host_dedication_id = ""
  # processes = []

# ─── Restart policy ───────────────────────────────────────────
# [[restart]]
#   policy   = "on-failure"
#   retries  = 0
#   processes = []

# ─── Top-level independent checks ─────────────────────────────
# [checks]
#   [checks.sample_http]
#     type         = "http"
#     port         = 5500
#     method       = "get"
#     path         = "/"
#     grace_period = "30s"
#     interval     = "15s"
#     timeout      = "10s"
#   [checks.sample_tcp]
#     type         = "tcp"
#     port         = 1234
#     grace_period = "30s"
#     interval     = "15s"
#     timeout      = "10s"

# ─── Multiple process groups (optional) ───────────────────────
# [processes]
#   app    = "/start-web"
#   worker = "/start-worker"

# ─── Metrics endpoint(s) ──────────────────────────────────────
# [[metrics]]
#   port      = 9091
#   path      = "/metrics"
#   processes = []

# ─── Static asset mapping (from container or Tigris) ─────────
# [[statics]]
#   guest_path   = "/app/public"
#   url_prefix   = "/public"
#   tigris_bucket = ""
#   index_document = ""

# ─── File injection on deploy ─────────────────────────────────
# [[files]]
#   guest_path  = "/etc/config.yaml"
#   raw_value   = ""                 # base64
#   local_path  = ""
#   secret_name = ""
#   processes   = []

# ─── Experimental overrides (subject to change) ──────────────
# [experimental]
#   allowed_public_ports = []
#   auto_rollback        = true
#   cmd        = []
#   entrypoint = []
#   exec       = []

