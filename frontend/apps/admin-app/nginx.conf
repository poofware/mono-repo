# Professional Nginx configuration for a Single Page Application (SPA) like Flutter Web.
worker_processes auto;
worker_rlimit_nofile 65535; # Increases the limit of open files per worker process.

# Required for Nginx to work.
events {
    worker_connections 16384; # Max connections per worker.
    multi_accept on; # Accept as many connections as possible.
}

http {
    # Include standard MIME types.
    include /etc/nginx/mime.types;

    # Default content type.
    default_type application/octet-stream;

    # Performance tuning
    sendfile on; # Enables sendfile() system call for direct copying between file descriptors.
    tcp_nopush on; # Optimize packet delivery for Nginx after sendfile is used.
    tcp_nodelay on; # Disables Nagle's algorithm, good for applications that require low latency.
    keepalive_timeout 30; # Timeout for keep-alive connections.

    server {
        listen 8080;

        # Server name (can be adjusted if needed, '_' matches any hostname).
        server_name localhost;

        # Root directory for web files.
        root /usr/share/nginx/html;

        # For SPAs: try to serve the requested file/directory,
        # otherwise fall back to index.html for client-side routing.
        location /admin/ {
            try_files $uri $uri/ /admin/index.html;
        }

        location / {
            return 301 /admin/;
        }

        # Health check endpoint for Docker Compose healthcheck.
        # Using '=' for an exact match is more efficient.
        location = /health {
            return 200 'healthy';
            add_header Content-Type text/plain;
        }
    }
}

